// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 1. 用户表 (包含个人资料)
model User {
  id          String   @id @default(cuid())
  username    String   @unique
  password    String   // 加密存储 (bcrypt)
  createdAt   DateTime @default(now())
  
  // 个人资料
  nickname    String?
  avatarUrl   String?
  slogan      String?
  aboutMe     String?
  location    String?
  socialLinks String?  // 存 JSON: { github: "...", email: "..." }

  // 关联
  likes       Like[]   // 用户点赞记录
  posts       Post[]   // 用户发布的文章
}

// 2. 站点动态配置表 (保留用于全站公告等，不再存个人信息)
model SiteConfig {
  id          Int      @id @default(1)
  siteName    String   @default("MySpace")
  footerText  String?
}

// 3. 文章表
model Post {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String?
  content     String
  coverImage  String?
  published   Boolean  @default(false)
  pinned      Boolean  @default(false)

  tags        String? 
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  comments    Comment[]
  likes       Like[]
  likeCount   Int       @default(0)

  // 关联作者
  author      User?     @relation(fields: [authorId], references: [id])
  authorId    String?   // 暂时可选，兼容旧数据
}

// 4. 评论表
model Comment {
  id        String   @id @default(cuid())
  nickname  String   // 访客昵称
  content   String   // 评论内容
  isAdmin   Boolean  @default(false) // 是否是博主回复
  isApproved Boolean @default(false) // 审核状态：false=待审, true=公开

  createdAt DateTime @default(now())

  // 关联文章
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  // 支持简单的嵌套回复 (父子评论)
  parentId  String?
  parent    Comment? @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")
}

// 5. 点赞表
model Like {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?

  @@unique([postId, userId])
}
